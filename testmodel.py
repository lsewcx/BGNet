from net.bgnet import Net
from torchinfo import summary

# 初始化模型
model = Net()

# 打印模型参数量
summary(model, input_size=(1, 3, 416, 416))


'''
===============================================================================================
Layer (type:depth-idx)                        Output Shape              Param #
===============================================================================================
Net                                           [1, 1, 416, 416]          --
├─Res2Net: 1-1                                [1, 256, 104, 104]        2,049,000
│    └─Sequential: 2-1                        [1, 64, 208, 208]         --
│    │    └─Conv2d: 3-1                       [1, 32, 208, 208]         864
│    │    └─BatchNorm2d: 3-2                  [1, 32, 208, 208]         64
│    │    └─ReLU: 3-3                         [1, 32, 208, 208]         --
│    │    └─Conv2d: 3-4                       [1, 32, 208, 208]         9,216
│    │    └─BatchNorm2d: 3-5                  [1, 32, 208, 208]         64
│    │    └─ReLU: 3-6                         [1, 32, 208, 208]         --
│    │    └─Conv2d: 3-7                       [1, 64, 208, 208]         18,432
│    └─BatchNorm2d: 2-2                       [1, 64, 208, 208]         128
│    └─ReLU: 2-3                              [1, 64, 208, 208]         --
│    └─MaxPool2d: 2-4                         [1, 64, 104, 104]         --
│    └─Sequential: 2-5                        [1, 256, 104, 104]        --
│    │    └─Bottle2neck: 3-8                  [1, 256, 104, 104]        69,304
│    │    └─Bottle2neck: 3-9                  [1, 256, 104, 104]        72,376
│    │    └─Bottle2neck: 3-10                 [1, 256, 104, 104]        72,376
│    └─Sequential: 2-6                        [1, 512, 52, 52]          --
│    │    └─Bottle2neck: 3-11                 [1, 512, 52, 52]          366,600
│    │    └─Bottle2neck: 3-12                 [1, 512, 52, 52]          287,752
│    │    └─Bottle2neck: 3-13                 [1, 512, 52, 52]          287,752
│    │    └─Bottle2neck: 3-14                 [1, 512, 52, 52]          287,752
│    └─Sequential: 2-7                        [1, 1024, 26, 26]         --
│    │    └─Bottle2neck: 3-15                 [1, 1024, 26, 26]         1,460,848
│    │    └─Bottle2neck: 3-16                 [1, 1024, 26, 26]         1,147,504
│    │    └─Bottle2neck: 3-17                 [1, 1024, 26, 26]         1,147,504
│    │    └─Bottle2neck: 3-18                 [1, 1024, 26, 26]         1,147,504
│    │    └─Bottle2neck: 3-19                 [1, 1024, 26, 26]         1,147,504
│    │    └─Bottle2neck: 3-20                 [1, 1024, 26, 26]         1,147,504
│    └─Sequential: 2-8                        [1, 2048, 13, 13]         --
│    │    └─Bottle2neck: 3-21                 [1, 2048, 13, 13]         5,832,288
│    │    └─Bottle2neck: 3-22                 [1, 2048, 13, 13]         4,583,008
│    │    └─Bottle2neck: 3-23                 [1, 2048, 13, 13]         4,583,008
├─EAM: 1-2                                    [1, 1, 104, 104]          --
│    └─Conv1x1: 2-9                           [1, 64, 104, 104]         --
│    │    └─Conv2d: 3-24                      [1, 64, 104, 104]         16,448
│    │    └─BatchNorm2d: 3-25                 [1, 64, 104, 104]         128
│    │    └─ReLU: 3-26                        [1, 64, 104, 104]         --
│    └─Conv1x1: 2-10                          [1, 256, 13, 13]          --
│    │    └─Conv2d: 3-27                      [1, 256, 13, 13]          524,544
│    │    └─BatchNorm2d: 3-28                 [1, 256, 13, 13]          512
│    │    └─ReLU: 3-29                        [1, 256, 13, 13]          --
│    └─Sequential: 2-11                       [1, 1, 104, 104]          --
│    │    └─ConvBNR: 3-30                     [1, 256, 104, 104]        737,792
│    │    └─ConvBNR: 3-31                     [1, 256, 104, 104]        590,336
│    │    └─Conv2d: 3-32                      [1, 1, 104, 104]          257
├─EFM: 1-3                                    [1, 256, 104, 104]        --
│    └─ConvBNR: 2-12                          [1, 256, 104, 104]        --
│    │    └─Sequential: 3-33                  [1, 256, 104, 104]        590,336
│    └─AdaptiveAvgPool2d: 2-13                [1, 256, 1, 1]            --
│    └─Conv1d: 2-14                           [1, 1, 256]               5
│    └─Sigmoid: 2-15                          [1, 256, 1, 1]            --
├─EFM: 1-4                                    [1, 512, 52, 52]          --
│    └─ConvBNR: 2-16                          [1, 512, 52, 52]          --
│    │    └─Sequential: 3-34                  [1, 512, 52, 52]          2,360,320
│    └─AdaptiveAvgPool2d: 2-17                [1, 512, 1, 1]            --
│    └─Conv1d: 2-18                           [1, 1, 512]               5
│    └─Sigmoid: 2-19                          [1, 512, 1, 1]            --
├─EFM: 1-5                                    [1, 1024, 26, 26]         --
│    └─ConvBNR: 2-20                          [1, 1024, 26, 26]         --
│    │    └─Sequential: 3-35                  [1, 1024, 26, 26]         9,439,232
│    └─AdaptiveAvgPool2d: 2-21                [1, 1024, 1, 1]           --
│    └─Conv1d: 2-22                           [1, 1, 1024]              5
│    └─Sigmoid: 2-23                          [1, 1024, 1, 1]           --
├─EFM: 1-6                                    [1, 2048, 13, 13]         --
│    └─ConvBNR: 2-24                          [1, 2048, 13, 13]         --
│    │    └─Sequential: 3-36                  [1, 2048, 13, 13]         37,752,832
│    └─AdaptiveAvgPool2d: 2-25                [1, 2048, 1, 1]           --
│    └─Conv1d: 2-26                           [1, 1, 2048]              7
│    └─Sigmoid: 2-27                          [1, 2048, 1, 1]           --
├─Conv1x1: 1-7                                [1, 64, 104, 104]         --
│    └─Conv2d: 2-28                           [1, 64, 104, 104]         16,448
│    └─BatchNorm2d: 2-29                      [1, 64, 104, 104]         128
│    └─ReLU: 2-30                             [1, 64, 104, 104]         --
├─Conv1x1: 1-8                                [1, 128, 52, 52]          --
│    └─Conv2d: 2-31                           [1, 128, 52, 52]          65,664
│    └─BatchNorm2d: 2-32                      [1, 128, 52, 52]          256
│    └─ReLU: 2-33                             [1, 128, 52, 52]          --
├─Conv1x1: 1-9                                [1, 256, 26, 26]          --
│    └─Conv2d: 2-34                           [1, 256, 26, 26]          262,400
│    └─BatchNorm2d: 2-35                      [1, 256, 26, 26]          512
│    └─ReLU: 2-36                             [1, 256, 26, 26]          --
├─Conv1x1: 1-10                               [1, 256, 13, 13]          --
│    └─Conv2d: 2-37                           [1, 256, 13, 13]          524,544
│    └─BatchNorm2d: 2-38                      [1, 256, 13, 13]          512
│    └─ReLU: 2-39                             [1, 256, 13, 13]          --
├─CoordAttention: 1-11                        [1, 256, 13, 13]          --
│    └─AdaptiveAvgPool2d: 2-40                [1, 256, 13, 1]           --
│    └─AdaptiveAvgPool2d: 2-41                [1, 256, 1, 13]           --
│    └─Conv2d: 2-42                           [1, 8, 26, 1]             2,056
│    └─BatchNorm2d: 2-43                      [1, 8, 26, 1]             16
│    └─ReLU: 2-44                             [1, 8, 26, 1]             --
│    └─Conv2d: 2-45                           [1, 256, 13, 1]           2,304
│    └─Conv2d: 2-46                           [1, 256, 1, 13]           2,304
├─CAM: 1-12                                   [1, 256, 26, 26]          --
│    └─Conv1x1: 2-47                          [1, 256, 26, 26]          --
│    │    └─Conv2d: 3-37                      [1, 256, 26, 26]          131,328
│    │    └─BatchNorm2d: 3-38                 [1, 256, 26, 26]          512
│    │    └─ReLU: 3-39                        [1, 256, 26, 26]          --
│    └─ConvBNR: 2-48                          [1, 64, 26, 26]           --
│    │    └─Sequential: 3-40                  [1, 64, 26, 26]           36,992
│    └─ConvBNR: 2-49                          [1, 64, 26, 26]           --
│    │    └─Sequential: 3-41                  [1, 64, 26, 26]           36,992
│    └─ConvBNR: 2-50                          [1, 64, 26, 26]           --
│    │    └─Sequential: 3-42                  [1, 64, 26, 26]           36,992
│    └─ConvBNR: 2-51                          [1, 64, 26, 26]           --
│    │    └─Sequential: 3-43                  [1, 64, 26, 26]           36,992
│    └─Conv1x1: 2-52                          [1, 256, 26, 26]          --
│    │    └─Conv2d: 3-44                      [1, 256, 26, 26]          65,792
│    │    └─BatchNorm2d: 3-45                 [1, 256, 26, 26]          512
│    │    └─ReLU: 3-46                        [1, 256, 26, 26]          --
│    └─ConvBNR: 2-53                          [1, 256, 26, 26]          --
│    │    └─Sequential: 3-47                  [1, 256, 26, 26]          590,336
├─CAM: 1-13                                   [1, 128, 52, 52]          --
│    └─Conv1x1: 2-54                          [1, 128, 52, 52]          --
│    │    └─Conv2d: 3-48                      [1, 128, 52, 52]          49,280
│    │    └─BatchNorm2d: 3-49                 [1, 128, 52, 52]          256
│    │    └─ReLU: 3-50                        [1, 128, 52, 52]          --
│    └─ConvBNR: 2-55                          [1, 32, 52, 52]           --
│    │    └─Sequential: 3-51                  [1, 32, 52, 52]           9,280
│    └─ConvBNR: 2-56                          [1, 32, 52, 52]           --
│    │    └─Sequential: 3-52                  [1, 32, 52, 52]           9,280
│    └─ConvBNR: 2-57                          [1, 32, 52, 52]           --
│    │    └─Sequential: 3-53                  [1, 32, 52, 52]           9,280
│    └─ConvBNR: 2-58                          [1, 32, 52, 52]           --
│    │    └─Sequential: 3-54                  [1, 32, 52, 52]           9,280
│    └─Conv1x1: 2-59                          [1, 128, 52, 52]          --
│    │    └─Conv2d: 3-55                      [1, 128, 52, 52]          16,512
│    │    └─BatchNorm2d: 3-56                 [1, 128, 52, 52]          256
│    │    └─ReLU: 3-57                        [1, 128, 52, 52]          --
│    └─ConvBNR: 2-60                          [1, 128, 52, 52]          --
│    │    └─Sequential: 3-58                  [1, 128, 52, 52]          147,712
├─CAM: 1-14                                   [1, 64, 104, 104]         --
│    └─Conv1x1: 2-61                          [1, 64, 104, 104]         --
│    │    └─Conv2d: 3-59                      [1, 64, 104, 104]         12,352
│    │    └─BatchNorm2d: 3-60                 [1, 64, 104, 104]         128
│    │    └─ReLU: 3-61                        [1, 64, 104, 104]         --
│    └─ConvBNR: 2-62                          [1, 16, 104, 104]         --
│    │    └─Sequential: 3-62                  [1, 16, 104, 104]         2,336
│    └─ConvBNR: 2-63                          [1, 16, 104, 104]         --
│    │    └─Sequential: 3-63                  [1, 16, 104, 104]         2,336
│    └─ConvBNR: 2-64                          [1, 16, 104, 104]         --
│    │    └─Sequential: 3-64                  [1, 16, 104, 104]         2,336
│    └─ConvBNR: 2-65                          [1, 16, 104, 104]         --
│    │    └─Sequential: 3-65                  [1, 16, 104, 104]         2,336
│    └─Conv1x1: 2-66                          [1, 64, 104, 104]         --
│    │    └─Conv2d: 3-66                      [1, 64, 104, 104]         4,160
│    │    └─BatchNorm2d: 3-67                 [1, 64, 104, 104]         128
│    │    └─ReLU: 3-68                        [1, 64, 104, 104]         --
│    └─ConvBNR: 2-67                          [1, 64, 104, 104]         --
│    │    └─Sequential: 3-69                  [1, 64, 104, 104]         36,992
├─Conv2d: 1-15                                [1, 1, 26, 26]            257
├─Conv2d: 1-16                                [1, 1, 52, 52]            129
├─Conv2d: 1-17                                [1, 1, 104, 104]          65
===============================================================================================
Total params: 79,859,394
Trainable params: 79,859,394
Non-trainable params: 0
Total mult-adds (G): 58.24
===============================================================================================
Input size (MB): 2.08
Forward/backward pass size (MB): 1021.36
Params size (MB): 311.24
Estimated Total Size (MB): 1334.68
===============================================================================================
'''